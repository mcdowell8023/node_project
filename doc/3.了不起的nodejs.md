
# 更了不起的Node.js

本章基本是概念，原版照搬 《狼书》

> Don't use a car as a boat.If you want a boat， then use a boat. -- 源于死月的提问回答

## 架构升级

### 从 LAMP 到 MEAN

Web 开发技术经过了两次大的架构演变，即从 LAMP 到 MEAN。

- LAMP
LAMP 是早期表现非常突出的开源 Web 技术集合之一，使用 Linux 操作系统，将 Apache 作为 Web 服务器，使用 MySQL 数据库，并将 PHP（或者 Python、Perl）作为生成基于 HTML 页面的编程语言。随着互联网的发展，这些技术被整合在一起，成为当时的最佳实践。自此以后，Web 技术栈进入大爆发时代，开发者可以快速且轻松地创建一个新的网站。
- MEAN
MEAN 出现在 2014 年左右，MEAN 代表着一种完全现代的 Web 开发方法：将 JavaScript 作为唯一语言，贯穿应用程序开发的所有环节，从客户端到服务器端，再到数据库持久层，这也是最新潮的全栈 JavaScript 架构。

MEAN 与传统 LAMP 一样，是一种全套开发工具的简称。
■ M：MongoDB，一个使用类似 JSON 风格进行存储的数据库，非常适合 JavaScript 语言调用。
■ E：Express，一个 Web 应用框架，提供组件和模块，帮助建立网站应用。
■ A：Angular，Google 开发的一个前端 MVVM 框架，注意此处说的 Angular 是 1.x 版本的。
■ N：Node.js，一个并发、异步、事件驱动的 JavaScript 服务器后端开发平台。

### 前后端分离

#### 传统单体应用

典型的企业应用大多采用 3 层架构模式
  ■ 表现层 ：处理 HTTP 请求，直接返回 HTML 渲染，或者返回 API 结果。对于一个复杂的应用系统，表现层通常是代码中比较重要的部分。
  ■ 业务逻辑层 ：完成具体的业务逻辑，是应用的核心组成部分。
  ■ 数据访问层 ：访问基础数据，例如数据库、缓存和消息队列等。

以Java为例： 后端的分层非常清晰，具体如下。
  ■ 先定义模型层（Model），数据库操作一般采用 ORM 库来简化操作，模型会和数据库里的表进行关联映射。
  ■ DAO（Data Access Object），就是我们常说的增删改查，主要对单个模型进行操作。
  ■ Service 层就是业务逻辑层，通常组合多个 DAO 对象进行某项业务处理。
  ■ Controller 里组装了多个 Service 对象，可实现具体的功能。

#### 今天的前后台分离

两个好处：

- 一是使得应用分两部分开发、部署和扩展，各自独立，提高开发和测试效率，因为逻辑更多位于前端，能够更好地应对需求变化；
- 二是简化后端开发，让后端开发人员将更多的精力放在后端业务处理上。

现在前后端的大致划分如图 3-2 所示。

![](https://pic4.zhimg.com/v2-95888f162e3e27e10617b36eb1a30eda_r.jpg)

按照传统分类方式：
表现层即前端，而业务逻辑层和数据访问层都属于后端。
目前，最常见的模式是前端 +API+ 后端服务，出于负载均衡、请求转发、反向代理、静态资源托管、防跨域等原因，往往需要搭配 Nginx 一起使用。

- 方式 1：请求—> Nginx—> 前端
一般来说，Nginx 是由运维团队（OPS）负责统一管理的，如果想要变更，就需要走变更申请流程，跨部门合作显得特别麻烦。但同时，前端又需要处理一些下线、重定向、兼容多版本等逻辑，解决历史遗留问题，如果每次变更都走变更流程，那开发效率是不可忍受的。既然 Nginx 必不可少，而前端又需要一定的可操作空间，那么是否可以基于这两点找到解决方案呢？最简单最常用的办法，就是在原有方式不变的情况下，在前端引入 Node.js。

- 方式 2：请求—> Nginx—> Node.js（前端）
这里的 Node.js 可以实现以下功能。
■ 提供请求转发、反向代理等功能。
■ 提供 Web 服务，所有后端语言（Java、PHP 等）能做到的，Node.js 都能做到。
■ 圈定范围，便于维护，只要修改功能包含在当前 Node.js 项目范围内即可维护。
■ 充当 HTTP 客户端，访问后端接口，但一般不直接访问数据库。
下面给出一张对比图，以便大家更好地理解，如图 3-3 所示。

![](https://pic3.zhimg.com/v2-a22d2fd66a1ef06d40b3a5f6339d14fe_r.jpg)

两种方式的差别如下。
■ 方式 1：过度依赖 Nginx，在部署运维和团队配合方面（尤其是跨部门）比较麻烦。
■ 方式 2：使用 Node.js 来替代 Nginx 的 HTTP 功能，让前端有更多的灵活性。


### 业务需求决定架构

架构演变是「分分合合」的，对前端架构来说也是一样的。从单体式应用的「大而全」，变为微服务的「一个页面就是一个服务」，完全是由业务需求决定的。

页面即服务[一个页面就是一个服务]（Page as Service ) 与 单体式应用的区别

![](https://pic4.zhimg.com/v2-9e61611a878bf6aab0da713086f00351_r.jpg)

在上表中可以看到，除了运维比较麻烦，页面即服务几乎都是优点。不过在当下 Docker 和 DevOps 如此成熟的情况下，运维已经变得非常轻松了，所以页面即服务是必然趋势。

### 静态 API

实现的方式有很多种，比较简单的如基于 Express、Koa 这样的成熟框架，也可以采用专门的静态 API 框架实现，比如著名的 typicode/json-server，想实现 REST API，只需要编辑 db.json，然后放入数据即可。


#### 关于 json-server 的 安装 使用

[使用json-server模拟服务器API](https://www.jianshu.com/p/5bb86a770e23)

```bash
# 安装
  sudo npm install -g json-server
# 使用
  json-server --watch db.json
# 使用
  http://localhost:3000/posts?id=1
```

## 全栈之路

如何能做到 Node.js 全栈。
要想做到全栈，核心在于以下两点。
■ 掌握后端不会的 UI（界面）。
■ 掌握前端不会的 DB（业务）。
> 全栈是一种信仰，不是拿来吹牛的，而是用来解决更多问题、应对更多变化的，做到全栈可以让自己的知识体系不留空白，享受自我实现的极致快乐。

### 从前端转

从前端往后端转，API 接口非常容易学会，像 Koa 这类框架大部分人一周也能学会，最难的是对 DB、ER 模型的理解，即对业务需求落地的理解。

**我们来想想一般的前端开发人员具备什么技能。**

- HTML。
- CSS（兼容浏览器）。
- JavaScript 会一点（可能更多的是会点 jQuery）。
- PS 切图。
- Firebug 和 Chrome Debuger 会的人不太多。
- 用过几个框架，大部分人是仅仅会用。
- 英语一般。
- 会一点 SVN 或 Git。

**那么他们如果想在前端领域做得更深入，有哪些难点呢？**

- 基础薄弱，如面向对象、设计模式、命令行工具、shell 编程、工程化构建等。
- 对编程思想的理解不够，MVC、IoC、约定大于配置等。
- 区分概念困难。
- 外围验收困难，如 H5 和 Hybird 等。
- 难以追赶趋势，不知如何学习新东西。

**以上皆是痛点，所以比较好的办法应该是下面这样的。**

- 玩转 npm、Gulp 这样的前端工具类（此时还是前端）。
- 使用 Node.js 进行前后端分离（此时还是前端）。
- 掌握 Express、Koa 这类框架。
- 掌握 Jade、EJS 等模板引擎。
- 使用 Nginx。
- 玩转后端异步流程处理。
- 玩转后端 MongoDB、MySQL 对应的 Node.js 模块。

先做最简单的前后端分离，里面没有任何和 DB 相关的内容，前端可以非常容易地学会。半年后，接触异步流程处理和数据库相关内容，学习后端代码，这样就可以做到全栈了。

> 以上全部摘自 《狼书：了不起的nodejs》
